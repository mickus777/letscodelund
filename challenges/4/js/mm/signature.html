<html>
<head>
	<style>
		canvas { border: 1px solid black;  }
	</style>
</head>
<body style="font-size: 22px; font-family: monospace;">

	<div style="float:left; margin-right: 10px; border-right: 1px solid #ccc; padding-right: 20px">
		Draw something:  
		<button onclick="setSigData(sig1, maxSignature); compare();">max' signature</button>
		<button onclick="sig1.clear(); compare();">clear</button>

		<br/>
		<canvas id="signature1" height="200" width="450"></canvas>
		<br/>
		Try to replicate it: <button onclick="sig2.clear(); compare();">clear</button>
		<br/>
		<canvas id="signature2" height="200" width="450"></canvas>
	</div>
	<div style="float:left; ">
		Fitted replication to original: <br/>
		<canvas id="signature3" style="background: #ccc" height="200" width="450"></canvas>
		<br/>
		Result: <span id="result"></span>
		
		<br/><br/>
		<small><i>Results are good if less than 15, okay if less than 50, and bad otherwise.</i></small>
	</div>
	<div style="clear:both"></div>
	<hr/>
	<p>
		Tip 1: You can try to fake my signature, or draw your own. <br/>
		Tip 2: Try to draw a circle, then try to replicate the same circle backwards. It will be considered bad. <br/>
		Tip 3: Draw a horizontal line with a bump at the end. Replicate the line but place the bump in the middle or beginning. The result should be positive. <br/>
	<br/>

	</p>

	<script src="dtw.js"></script>
	<script src="signature_pad.js"></script>

	<script>
		function distanceFunction(a,b) { 
			var x = Math.abs(a.x - b.x);
			var y = Math.abs(a.y - b.y);
			return Math.sqrt(x*x + y*y); 
		};
		
		var canvas1 = document.getElementById("signature1");
		var canvas2 = document.getElementById("signature2");
		var canvas3 = document.getElementById("signature3");

		var sig1 = new SignaturePad(canvas1);
		var sig2 = new SignaturePad(canvas2);
		var sig3 = new SignaturePad(canvas3);

		sig1.onEnd = compare;
		sig2.onEnd = compare;

		function compare() {
			var points1 = sig1.toData();
			var points2 = sig2.toData();

			// Fit second set of points to the bounds of the first signature
			points2 = fit(points2, getBounds(points1));
			// Show the fitted signature
			sig3.fromData(points2);

			points1 = [].concat.apply([], points1); // javascript hack to flatten array of arrays
			points2 = [].concat.apply([], points2); // javascript hack to flatten array of arrays
			
			// Dynamic Time Warping
			var res = DTWDistance(points1, points2, distanceFunction);

			// Print out the result, adjusted for number of points
			res = res / Math.min(points1.length, points2.length);

			var resultElement = document.getElementById("result");
			if (res >= 0 && res < Infinity) {
				resultElement.innerHTML = 
					(res < 15 ? "Good: " : 
						(res < 50 ? "Maybe: " : 
							"Nuh-uh: ")) 
					+ res;
				resultElement.style.color = 
					res < 15 ? "green" : 
						(res < 50 ? "orange" : 
							"red");
			} else {
				resultElement.style.color = "black";
				resultElement.innerHTML = "please draw something";
			}
		}


		// Utilities:
		function getBounds(points) {
			var minX = Infinity,
				minY = Infinity,
				maxX = -Infinity,
				maxY = -Infinity;

			for (var i=0; i<points.length; i++) {
				var ps = points[i];
				for (var j=0; j<ps.length; j++) {
					var p = ps[j];
					if (p.x < minX) minX = p.x;
					if (p.x > maxX) maxX = p.x;

					if (p.y < minY) minY = p.y;
					if (p.y > maxY) maxY = p.y;
				}
			}
			return {minX:minX, minY:minY, maxX:maxX, maxY:maxY};
		}

		function fit(points, bounds) {
			var bounds2 = getBounds(points);
			var moveX = bounds2.minX - bounds.minX;
			var moveY = bounds2.minY - bounds.minY;
			var resizeX = (bounds.maxX-bounds.minX) / (bounds2.maxX-bounds2.minX);
			var resizeY = (bounds.maxY-bounds.minY) / (bounds2.maxY-bounds2.minY);

			return points.map(function(ps) {
				return ps.map(function(p) {
					return {
						x: ((p.x - bounds2.minX)*resizeX +bounds2.minX) - moveX,
						y: ((p.y - bounds2.minY)*resizeY +bounds2.minY) - moveY
					};
				});
			});
		}


		function setSigData(sigpad, data) {
			sigpad.clear();
			for (var i=0; i<data.length; i++) {
				var points = data[i];
				var p = points[0];
				sigpad._strokeBegin({clientX: p.x, clientY: p.y});
				for (var j=1; j<points.length; j++) {
					var p = points[j];
					sigpad._strokeUpdate({clientX: p.x, clientY: p.y});
				}
				sigpad._strokeEnd({});
			}
		}
		var maxSignature = JSON.parse('[[{"x":29,"y":180,"time":1489521252581},{"x":33,"y":172.5,"time":1489521252686},{"x":35,"y":168.5,"time":1489521252689},{"x":37.5,"y":164,"time":1489521252698},{"x":41.5,"y":157.5,"time":1489521252702},{"x":45.5,"y":150.5,"time":1489521252711},{"x":54.5,"y":135,"time":1489521252715},{"x":64.5,"y":118,"time":1489521252725},{"x":74.5,"y":102.5,"time":1489521252729},{"x":83.5,"y":88.5,"time":1489521252738},{"x":93,"y":75.5,"time":1489521252742},{"x":101.5,"y":63.5,"time":1489521252751},{"x":110,"y":51.5,"time":1489521252755},{"x":116.5,"y":41.5,"time":1489521252764},{"x":122,"y":32,"time":1489521252768},{"x":126.5,"y":26,"time":1489521252777},{"x":130.5,"y":21.5,"time":1489521252783},{"x":132.5,"y":19,"time":1489521252791},{"x":133,"y":18.5,"time":1489521252795},{"x":133,"y":19.5,"time":1489521252805},{"x":132,"y":21.5,"time":1489521252808},{"x":130.5,"y":24.5,"time":1489521252817},{"x":128.5,"y":27.5,"time":1489521252821},{"x":126,"y":30.5,"time":1489521252831},{"x":124,"y":34,"time":1489521252834},{"x":121,"y":39.5,"time":1489521252845},{"x":117.5,"y":46,"time":1489521252848},{"x":113,"y":54,"time":1489521252857},{"x":107.5,"y":62,"time":1489521252861},{"x":103,"y":69,"time":1489521252870},{"x":99,"y":76,"time":1489521252874},{"x":95.5,"y":83,"time":1489521252884},{"x":93,"y":89.5,"time":1489521252888},{"x":91,"y":95.5,"time":1489521252897},{"x":89.5,"y":101,"time":1489521252901},{"x":89.5,"y":105,"time":1489521252911},{"x":90,"y":109,"time":1489521252914},{"x":90.5,"y":111.5,"time":1489521252923},{"x":91.5,"y":113,"time":1489521252928},{"x":92,"y":114,"time":1489521252936},{"x":93,"y":113.5,"time":1489521252940},{"x":94,"y":112.5,"time":1489521252951},{"x":95.5,"y":111.5,"time":1489521252955},{"x":98.5,"y":109.5,"time":1489521252964},{"x":103,"y":107,"time":1489521252968},{"x":107.5,"y":103,"time":1489521252976},{"x":112.5,"y":98,"time":1489521252982},{"x":119,"y":92.5,"time":1489521252989},{"x":126,"y":86,"time":1489521252994},{"x":133,"y":79,"time":1489521253003},{"x":140,"y":71.5,"time":1489521253008},{"x":145.5,"y":64.5,"time":1489521253016},{"x":151,"y":57,"time":1489521253021},{"x":156,"y":50.5,"time":1489521253029},{"x":160.5,"y":44,"time":1489521253034},{"x":164.5,"y":39,"time":1489521253042},{"x":168,"y":34.5,"time":1489521253047},{"x":170.5,"y":31,"time":1489521253056},{"x":172,"y":28,"time":1489521253062},{"x":174,"y":25.5,"time":1489521253069},{"x":176.5,"y":24,"time":1489521253074},{"x":178,"y":23,"time":1489521253082},{"x":178.5,"y":23,"time":1489521253087},{"x":178,"y":23,"time":1489521253096},{"x":177,"y":24,"time":1489521253100},{"x":176,"y":25,"time":1489521253108},{"x":175,"y":26,"time":1489521253113},{"x":174.5,"y":27.5,"time":1489521253122},{"x":174,"y":29,"time":1489521253127},{"x":172.5,"y":32,"time":1489521253135},{"x":170.5,"y":34.5,"time":1489521253140},{"x":168,"y":38.5,"time":1489521253148},{"x":165,"y":43,"time":1489521253153},{"x":159,"y":53,"time":1489521253163},{"x":152,"y":64.5,"time":1489521253167},{"x":145,"y":75,"time":1489521253175},{"x":138.5,"y":84.5,"time":1489521253180},{"x":133.5,"y":94,"time":1489521253188},{"x":129.5,"y":103.5,"time":1489521253194},{"x":126,"y":112,"time":1489521253201},{"x":123,"y":120,"time":1489521253206},{"x":120,"y":127.5,"time":1489521253214},{"x":117,"y":135,"time":1489521253219},{"x":115,"y":141.5,"time":1489521253229},{"x":113,"y":147.5,"time":1489521253233},{"x":111.5,"y":153,"time":1489521253241},{"x":111,"y":157.5,"time":1489521253246},{"x":110,"y":161.5,"time":1489521253254},{"x":110,"y":165,"time":1489521253260},{"x":110,"y":167,"time":1489521253267},{"x":110,"y":168.5,"time":1489521253273},{"x":111,"y":169.5,"time":1489521253281},{"x":112,"y":170,"time":1489521253286},{"x":113,"y":170,"time":1489521253295},{"x":114,"y":170,"time":1489521253299},{"x":115,"y":170,"time":1489521253307},{"x":116,"y":169.5,"time":1489521253312},{"x":117,"y":169.5,"time":1489521253320},{"x":118.5,"y":169,"time":1489521253325},{"x":119,"y":169,"time":1489521253334},{"x":120,"y":168.5,"time":1489521253338},{"x":121,"y":168.5,"time":1489521253347},{"x":122.5,"y":168,"time":1489521253352},{"x":123.5,"y":168,"time":1489521253361},{"x":124,"y":167.5,"time":1489521253365},{"x":125.5,"y":166.5,"time":1489521253373},{"x":127,"y":166,"time":1489521253378},{"x":128.5,"y":165,"time":1489521253387},{"x":130,"y":164,"time":1489521253391},{"x":132,"y":162.5,"time":1489521253401},{"x":134,"y":161,"time":1489521253405},{"x":135.5,"y":159.5,"time":1489521253413},{"x":137.5,"y":158,"time":1489521253418},{"x":139.5,"y":156.5,"time":1489521253427},{"x":141.5,"y":154.5,"time":1489521253431},{"x":143.5,"y":152.5,"time":1489521253440},{"x":146.5,"y":150,"time":1489521253444},{"x":149,"y":147.5,"time":1489521253453},{"x":152,"y":145,"time":1489521253458},{"x":154,"y":142.5,"time":1489521253466},{"x":156.5,"y":139.5,"time":1489521253471},{"x":158.5,"y":137.5,"time":1489521253479},{"x":160,"y":135,"time":1489521253484},{"x":161.5,"y":133,"time":1489521253493},{"x":162,"y":131.5,"time":1489521253497},{"x":162.5,"y":130,"time":1489521253506},{"x":163,"y":129.5,"time":1489521253510},{"x":163,"y":129,"time":1489521253519},{"x":163,"y":128.5,"time":1489521253533},{"x":162.5,"y":128.5,"time":1489521253545},{"x":162,"y":129,"time":1489521253550},{"x":161.5,"y":129,"time":1489521253559},{"x":161,"y":129.5,"time":1489521253563},{"x":160.5,"y":130,"time":1489521253572},{"x":159.5,"y":131,"time":1489521253577},{"x":158.5,"y":132,"time":1489521253585},{"x":157.5,"y":133,"time":1489521253590},{"x":156.5,"y":134,"time":1489521253599},{"x":155.5,"y":135.5,"time":1489521253603},{"x":154.5,"y":137,"time":1489521253612},{"x":153.5,"y":139,"time":1489521253616},{"x":152.5,"y":140.5,"time":1489521253626},{"x":151.5,"y":142,"time":1489521253630},{"x":151,"y":144,"time":1489521253639},{"x":149,"y":147.5,"time":1489521253644},{"x":148,"y":150.5,"time":1489521253651},{"x":147,"y":153,"time":1489521253656},{"x":146.5,"y":155.5,"time":1489521253665},{"x":145.5,"y":158.5,"time":1489521253669},{"x":145.5,"y":161,"time":1489521253678},{"x":145.5,"y":163,"time":1489521253682},{"x":146.5,"y":164,"time":1489521253692},{"x":147.5,"y":164.5,"time":1489521253696},{"x":149,"y":164.5,"time":1489521253704},{"x":150.5,"y":164.5,"time":1489521253710},{"x":152,"y":164,"time":1489521253717},{"x":153.5,"y":163,"time":1489521253722},{"x":155.5,"y":161.5,"time":1489521253731},{"x":157.5,"y":160.5,"time":1489521253735},{"x":159.5,"y":159,"time":1489521253745},{"x":161.5,"y":157.5,"time":1489521253749},{"x":163.5,"y":156,"time":1489521253757},{"x":166,"y":154.5,"time":1489521253762},{"x":168.5,"y":153,"time":1489521253770},{"x":170.5,"y":152,"time":1489521253775},{"x":172,"y":151.5,"time":1489521253784},{"x":174,"y":151,"time":1489521253788},{"x":175,"y":151,"time":1489521253797},{"x":176,"y":151,"time":1489521253802},{"x":177,"y":151.5,"time":1489521253810},{"x":177.5,"y":152,"time":1489521253815},{"x":178,"y":153,"time":1489521253823},{"x":178,"y":154,"time":1489521253828},{"x":178.5,"y":154.5,"time":1489521253837},{"x":178.5,"y":155.5,"time":1489521253841},{"x":178.5,"y":156,"time":1489521253850},{"x":179,"y":157,"time":1489521253855},{"x":179,"y":158,"time":1489521253863},{"x":179.5,"y":159,"time":1489521253868},{"x":179.5,"y":160,"time":1489521253876},{"x":180,"y":161,"time":1489521253881},{"x":180.5,"y":161.5,"time":1489521253890},{"x":181,"y":162.5,"time":1489521253895},{"x":181.5,"y":163.5,"time":1489521253903},{"x":182.5,"y":164,"time":1489521253907},{"x":183.5,"y":164.5,"time":1489521253916},{"x":184.5,"y":165,"time":1489521253920},{"x":186,"y":165,"time":1489521253929},{"x":187.5,"y":165.5,"time":1489521253934},{"x":189,"y":165,"time":1489521253943},{"x":190.5,"y":164.5,"time":1489521253947},{"x":192.5,"y":164,"time":1489521253956},{"x":194,"y":163.5,"time":1489521253961},{"x":196,"y":162.5,"time":1489521253969},{"x":198,"y":161,"time":1489521253973},{"x":200,"y":160,"time":1489521253983},{"x":204,"y":157,"time":1489521253987},{"x":207.5,"y":154,"time":1489521253996},{"x":212,"y":150,"time":1489521254000},{"x":216,"y":146.5,"time":1489521254009},{"x":220.5,"y":142.5,"time":1489521254013},{"x":225,"y":138,"time":1489521254022},{"x":228,"y":135,"time":1489521254027},{"x":229.5,"y":134,"time":1489521254035},{"x":229.5,"y":133.5,"time":1489521254040},{"x":228.5,"y":133.5,"time":1489521254048},{"x":227,"y":134,"time":1489521254053},{"x":225,"y":135.5,"time":1489521254063},{"x":223,"y":137.5,"time":1489521254066},{"x":222,"y":139.5,"time":1489521254075},{"x":220.5,"y":141,"time":1489521254080},{"x":219.5,"y":143,"time":1489521254088},{"x":218,"y":145.5,"time":1489521254093},{"x":217,"y":147.5,"time":1489521254101},{"x":215.5,"y":150.5,"time":1489521254106},{"x":214.5,"y":152.5,"time":1489521254115},{"x":213,"y":155,"time":1489521254119},{"x":212.5,"y":157,"time":1489521254128},{"x":211.5,"y":159.5,"time":1489521254133},{"x":211,"y":161.5,"time":1489521254141},{"x":211,"y":163,"time":1489521254146},{"x":211,"y":165,"time":1489521254154},{"x":211.5,"y":166.5,"time":1489521254159},{"x":212,"y":167.5,"time":1489521254168},{"x":212.5,"y":169,"time":1489521254172},{"x":213.5,"y":170,"time":1489521254182},{"x":214,"y":170.5,"time":1489521254185},{"x":215,"y":171.5,"time":1489521254194},{"x":216,"y":172,"time":1489521254199},{"x":217.5,"y":173,"time":1489521254208},{"x":219,"y":173.5,"time":1489521254212},{"x":220.5,"y":174.5,"time":1489521254221},{"x":222,"y":175,"time":1489521254225},{"x":223.5,"y":175.5,"time":1489521254234},{"x":225,"y":176.5,"time":1489521254238},{"x":226.5,"y":177,"time":1489521254247},{"x":228,"y":178,"time":1489521254251}],[{"x":251,"y":187.5,"time":1489521254680},{"x":257.5,"y":174,"time":1489521254736},{"x":263,"y":163.5,"time":1489521254745},{"x":269.5,"y":151.5,"time":1489521254750},{"x":275.5,"y":140,"time":1489521254758},{"x":281.5,"y":129,"time":1489521254762},{"x":288.5,"y":117,"time":1489521254771},{"x":296,"y":104.5,"time":1489521254775},{"x":303,"y":92.5,"time":1489521254785},{"x":309.5,"y":80,"time":1489521254789},{"x":314.5,"y":68.5,"time":1489521254798},{"x":319.5,"y":57,"time":1489521254802},{"x":324.5,"y":46.5,"time":1489521254811},{"x":330.5,"y":37.5,"time":1489521254815},{"x":335,"y":30.5,"time":1489521254824},{"x":339,"y":24.5,"time":1489521254828},{"x":340.5,"y":20.5,"time":1489521254837},{"x":341,"y":17.5,"time":1489521254841},{"x":341,"y":17,"time":1489521254851},{"x":340,"y":17.5,"time":1489521254855},{"x":339.5,"y":19.5,"time":1489521254864},{"x":339,"y":22,"time":1489521254868},{"x":337.5,"y":24.5,"time":1489521254877},{"x":336,"y":27,"time":1489521254881},{"x":333,"y":31,"time":1489521254890},{"x":328.5,"y":37,"time":1489521254894},{"x":323,"y":45,"time":1489521254904},{"x":317,"y":54.5,"time":1489521254909},{"x":311,"y":64.5,"time":1489521254917},{"x":305,"y":74.5,"time":1489521254921},{"x":299.5,"y":86,"time":1489521254930},{"x":294.5,"y":98,"time":1489521254934},{"x":289.5,"y":110.5,"time":1489521254943},{"x":284.5,"y":123,"time":1489521254947},{"x":280,"y":134,"time":1489521254957},{"x":276,"y":144.5,"time":1489521254960},{"x":274,"y":153,"time":1489521254970},{"x":272.5,"y":160.5,"time":1489521254974},{"x":273,"y":166,"time":1489521254983},{"x":274,"y":170,"time":1489521254987},{"x":275.5,"y":172.5,"time":1489521254996},{"x":277,"y":174.5,"time":1489521255001},{"x":279,"y":174.5,"time":1489521255010},{"x":280.5,"y":173.5,"time":1489521255014},{"x":283.5,"y":172,"time":1489521255023},{"x":286.5,"y":170,"time":1489521255028},{"x":290.5,"y":166.5,"time":1489521255036},{"x":295.5,"y":162,"time":1489521255041},{"x":301,"y":155.5,"time":1489521255049},{"x":308,"y":148,"time":1489521255054},{"x":314.5,"y":140.5,"time":1489521255062},{"x":320.5,"y":132,"time":1489521255067},{"x":325,"y":125.5,"time":1489521255076},{"x":328,"y":120,"time":1489521255081},{"x":329.5,"y":117,"time":1489521255090},{"x":330,"y":115.5,"time":1489521255094},{"x":330,"y":116,"time":1489521255102},{"x":330,"y":117.5,"time":1489521255108},{"x":329,"y":120,"time":1489521255115},{"x":327.5,"y":122,"time":1489521255120},{"x":324.5,"y":127,"time":1489521255130},{"x":320.5,"y":133.5,"time":1489521255134},{"x":316.5,"y":142,"time":1489521255142},{"x":312.5,"y":151.5,"time":1489521255147},{"x":308.5,"y":160.5,"time":1489521255156},{"x":304.5,"y":169.5,"time":1489521255160},{"x":301,"y":177.5,"time":1489521255168},{"x":298,"y":184.5,"time":1489521255174},{"x":296.5,"y":190,"time":1489521255182},{"x":295.5,"y":194,"time":1489521255187},{"x":296,"y":195.5,"time":1489521255195},{"x":297.5,"y":195.5,"time":1489521255200},{"x":300,"y":194,"time":1489521255208},{"x":303,"y":192,"time":1489521255213},{"x":307,"y":186.5,"time":1489521255222},{"x":311.5,"y":179.5,"time":1489521255226},{"x":318.5,"y":167,"time":1489521255235},{"x":326.5,"y":151.5,"time":1489521255239},{"x":335.5,"y":134.5,"time":1489521255248},{"x":345.5,"y":116.5,"time":1489521255253},{"x":355.5,"y":99,"time":1489521255262},{"x":365.5,"y":82.5,"time":1489521255266},{"x":374,"y":67,"time":1489521255275},{"x":382,"y":52.5,"time":1489521255279},{"x":387.5,"y":41,"time":1489521255289},{"x":391,"y":31.5,"time":1489521255292},{"x":392.5,"y":27,"time":1489521255301},{"x":393.5,"y":25,"time":1489521255306},{"x":392.5,"y":26,"time":1489521255314},{"x":389.5,"y":28.5,"time":1489521255319},{"x":386.5,"y":31.5,"time":1489521255327},{"x":383.5,"y":35.5,"time":1489521255332},{"x":378,"y":42.5,"time":1489521255341},{"x":371.5,"y":51,"time":1489521255345},{"x":364.5,"y":61,"time":1489521255355},{"x":357,"y":72,"time":1489521255359},{"x":350.5,"y":84,"time":1489521255367},{"x":344.5,"y":97,"time":1489521255372},{"x":338.5,"y":110.5,"time":1489521255380},{"x":333,"y":124.5,"time":1489521255385},{"x":327.5,"y":138,"time":1489521255393},{"x":322.5,"y":151,"time":1489521255398},{"x":318.5,"y":162,"time":1489521255407},{"x":316,"y":172,"time":1489521255411},{"x":314.5,"y":180.5,"time":1489521255420},{"x":313.5,"y":188,"time":1489521255425},{"x":313.5,"y":194,"time":1489521255433},{"x":314,"y":198,"time":1489521255438},{"x":315,"y":200.5,"time":1489521255446},{"x":316.5,"y":202,"time":1489521255451},{"x":319,"y":202.5,"time":1489521255460},{"x":321.5,"y":202.5,"time":1489521255464},{"x":325,"y":201.5,"time":1489521255474},{"x":329.5,"y":199.5,"time":1489521255478},{"x":334.5,"y":196.5,"time":1489521255486},{"x":341,"y":193,"time":1489521255491},{"x":349,"y":188,"time":1489521255499},{"x":358,"y":182,"time":1489521255505},{"x":368,"y":176,"time":1489521255513},{"x":378.5,"y":169.5,"time":1489521255517},{"x":388,"y":163.5,"time":1489521255526},{"x":397.5,"y":158,"time":1489521255531},{"x":407,"y":154,"time":1489521255539},{"x":416,"y":150.5,"time":1489521255544},{"x":425.5,"y":147.5,"time":1489521255552},{"x":434.5,"y":145.5,"time":1489521255557},{"x":442.5,"y":144.5,"time":1489521255565},{"x":449,"y":144,"time":1489521255570},{"x":455,"y":144.5,"time":1489521255580},{"x":460.5,"y":145.5,"time":1489521255583},{"x":465,"y":146.5,"time":1489521255593},{"x":470,"y":147.5,"time":1489521255597},{"x":473.5,"y":149,"time":1489521255605},{"x":476,"y":150.5,"time":1489521255610}],[{"x":368,"y":145,"time":1489521255831}]]');

	</script>



</body>
</html>